<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	data-layout-decorate="~{layout/defaultLayout}">
<th:block layout:fragment="css">
	<style type="text/css">
		#addAdminForm{
			width: 500px;
			margin: auto;
		}
		.tab-content{
			background-color: #fff;
		}
		.buttons{
			text-align: center;
		}
	</style>
</th:block>
<th:block layout:fragment="script">
	<script type="text/javascript">
        $(document).ready(function(){           
        	/* side menu */
        	$(".nav-tabs a").click(function(e){
                $(this).tab('show');
                e.preventDefault();
            });
        });
    </script>
</th:block>
<th:block layout:fragment="script">
	<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
	    	/*특수문자를 포함*/
	    	var specialPattern = /^.*(?=.*[`~!@#$%^&*|\\\'\";:\/?]).*$/;
	    	/*대문자, 소문자로 시작하는 7-16자 이내의 아이디*/
	    	var checkId = /^[A-Za-z]{1}[A-Za-z0-9]{6,15}$/;
	    	/*비밀번호 유효성검사 : 5-20자 이내의 숫자,문자,특수문자를 포함한 비밀번호*/
	    	var checkPw = /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*?[#?!@$%^&*-]).{7,15}$/;
	    	/*이름 유효성검사 : 한글 혹은 영문 이름(띄어쓰기 가능)*/
		    var checkName=/^[가-힣a-zA-Z\s]+$/;
	    	/*아이디 중복검사를 위한 함수*/
		    idSet = false;
	    	function idAdminCheck(){
	    		return  idSet;
	    	}
	
		    /*아이디 중복검사*/
		    $('#adminId').focus();
		    $('#adminId').blur(function() {
		    	if($('#adminId').val().length < 1) {
					$('#idHelper').text('아이디를 입력해주세요');
					$('#adminId').focus();
				}
		    	console.log('아이디 중복검사');
		    	var isIdCheck = 0;
		    	var adminId = $('#adminId').val();
		    	var idHelper = $('#idHelper');
		    	
		    	$.ajax({
		    		async : false,
		    		url : '/adminIdCheck',
		    		type : 'POST',
		    		data : adminId,
		    		dataType : 'json',
		    		contentType: "application/json; charset=UTF-8",
		    		success : function(data){
		    			console.log('data 받아오기 성공');
						console.log(data + '<---countId');
						if(data != isIdCheck) {		// 아이디 중복
							idHelper.text('중복된 아이디입니다. 새로운 아이디를 만들어주세요');
							idSet = false;
							$('#adminId').focus();
						} else if(data == isIdCheck) {		// 아이디 사용가능, 유효성검사
							/*아이디에 특수문자가 들어가지 못하도록, 대소문자로 시작하여 7-16자 이내로 만들어지도록*/
							if(specialPattern.test(adminId)) {
								idHelper.text('아이디에 특수문자는 들어갈 수 없습니다')
								idSet = false;
								$('#adminId').focus();
							} else if(!checkId.test(adminId)) {
								idHelper.text('대문자, 소문자로 시작하고 7-16자 이내로 만들어주세요');
								idSet = false;
								$('#adminId').focus();
							} else {
								idHelper.text('사용 가능한 아이디 입니다');
								idSet = true;
							}
						}
		    		},
		    		error: function(error) {					
						console.log("error: "+error);
					}
		    	});
		    });
		    /*비밀번호 유효성검사*/
		    $('#adminPw').blur(function() {
		    	if(!checkPw.test($('#adminPw').val())){
		    		$('#pwHelper').text('숫자, 문자, 특수문자를 포함하여 7-15자 이내로 만들어주세요');
		    		$('#adminPw').focus();
		    	} else {
		    		$('#pwHelper').text('');
		    	}
		    })
		    /*비밀번호 확인*/
		    $('#adminPwCheck').blur(function() {
		    	if(($('#adminPw').val() != $('#adminPwCheck').val())){
		    		$('#pwCheckHelper').text('비밀번호가  다릅니다');
		    		$('#adminPw').focus();
		    	} else {
		    		$('#pwCheckHelper').text('');
		    	}
		    })
		    /*이름 유효성 검사*/
		    $('#adminName').blur(function() {    	
		    	if(!checkName.test($('#adminName').val())){
		    		$('#nameHelper').text('한글 혹은 영어로 정확히 입력해주세요');
		    		$('#adminName').focus();
		    	} else if($('#adminName').val().length < 2 || $('#adminName').val().length > 15){
		    		$('#nameHelper').text('2-15자 이내로 만들어주세요');
		    		$('#adminName').focus();
		    	}else {
		    		$('#nameHelper').text('');
		    	}
		    })
		    /*폼 제출 유효성 검사*/
		    $('#submitBtn').click(function() {
		    	var adminId = $('#adminId').val();
		    	var adminPw = $('#adminPw').val();
		    	var adminName = $('#adminName').val();
		    	/*모든 입력칸이 빈칸이 아닐 때*/
		    	var condition = adminId != "" && adminPw != "" && adminName != "";
				/*아이디에 특수문자가 있음*/
		    	var idPatternCheck = specialPattern.test(adminId);
				/*대소문자로 시작하는 7-16자 이내의 아이디*/
		    	var idCheck = checkId.test(adminId);
				/*숫자, 문자, 특수문자를 포함하여 7-15자 이내인 비밀번호*/
		    	var pwCheck = checkPw.test($('#adminPw').val());
				/*비밀번호 확인*/
		    	var pwDoubleCheck = ($('#adminPw').val() == $('#adminPwCheck').val())
		    	/*한글 혹은 영어인 이름*/
		    	var nameCheck = checkName.test($('#adminName').val());
				/*길이가 2-15자 이내가 아닌 이름*/
		    	var nameLengthCheck = ($('#adminName').val().length < 2 || $('#adminName').val().length > 15);
	
		    	if(condition) {		// 빈칸이 없을 때
		    		if(!idPatternCheck && idCheck && pwCheck && pwDoubleCheck && nameCheck && !nameLengthCheck){	// 아이디, 비밀번호, 이름 유효성검사가 통과됐을 때
		    			if(idAdminCheck() != true){		// idAdminCheck가 false일 때(아이디 중복)
			    			event.preventDefault();
			    			$('#idHelper').text('중복된 아이디입니다. 새로운 아이디를 만들어주세요');
			    		} else if(idAdminCheck() == true){		// idAdminCheck가 true일 때(아이디 사용가능)
			    			$('#addAdminForm').submit();
			            	$('#submitHelper').text('');
			    		}
		    		} else if(!pwDoubleCheck) {		// 비밀번호와 확인이 일치하지 않을 때
		    			event.preventDefault();
		    			$('#adminPw').focus();
		    			$('#pwHelper').text('비밀번호가 서로 다릅니다');
		    		}
		    	} else if(!condition) {		// 빈칸이 있을 때
		    		event.preventDefault();
		    		$('#submitHelper').text('빈 칸 없이 양식에 맞게 작성해주세요');
		    	} else {
		    		$('#submitHelper').text('');
		    	}
	        });
		});
	</script>
</th:block>

	<div layout:fragment="content" class="main-box container">
		<div class="container mypage">
			<div class="row">
				<!-- mypage side nav -->
           		<div class="col-md-3 mypage-nav">
           			<ul class="nav nav-tabs flex-column">
	                    <li class="nav-item">
	                      <a class="nav-link active" th:href="@{/topAdmin/listAdmin}">관리자관리</a>
	                    </li>	                    
	                    <li class="nav-item">
	                      <a class="nav-link" href="#mypage-content-profit-management">수익관리</a>
	                    </li>
	                </ul>
           		</div>
           		<!-- mypage content -->
	            <div class="col-md-9">
	            	<div class="mypage-content tab-content">
		            	<!-- 관리자 등록 -->
		            	<!-- <div id="mypage-content-admin-management" class="tab-pane active"> -->
							<h2>관리자 등록</h2>
							<form action="/topAdmin/addAdminAction" id="addAdminForm" method="post">
								<div class="form-group">
									<label for="adminId">아이디</label>
									<input type="text" name="adminId" id="adminId" class="form-control">
									<span id="idHelper" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="adminPw">비밀번호</label>
									<input type="password" name="adminPw" id="adminPw" class="form-control">
									<span id="pwHelper" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="adminPwCheck">비밀번호 확인</label>
									<input type="password" name="adminPwCheck" id="adminPwCheck" class="form-control">
									<span id="pwCheckHelper" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="adminName">이름</label>
									<input type="text" name="adminName" id="adminName" class="form-control">
									<span id="nameHelper" class="text-danger"></span>
								</div>
								<div class="form-group buttons">
									<button type="button" id="submitBtn" class="btn">등록</button>
									<a th:href="@{/topAdmin/listAdmin}">
										<button type="button" class="btn">취소</button>
									</a><p>
									<span id="submitHelper" class="text-danger"></span>
								</div>
							</form>
						<!-- </div> -->
					</div>
				</div>
			</div>
		</div>
	</div>
</html>